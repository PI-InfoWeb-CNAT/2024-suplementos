{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}Meu Carrinho{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/carrinho.css' %}">
{% endblock %}

{% block sidebar %}
    <ul class="menu">
        <li><a href="{% url 'home' %}"><i class="bi bi-house-door-fill menu-icon"></i>Página Inicial</a></li>
        <li><a href="{% url 'promocoes' %}"><i class="bi bi-lightning-charge-fill menu-icon"></i>Promoções</a></li>
        <li><a href="/maisvendidos"><i class="bi bi-trophy-fill menu-icon"></i>Mais Vendidos</a></li>
        <li><a href="/meuspedidos"><i class="bi bi-basket3-fill menu-icon"></i>Meus Pedidos</a></li>
        <li><a href="/meusfavoritos"><i class="bi bi-heart-fill menu-icon"></i>Meus Favoritos</a></li>
        <li><a href="/perfil"><i class="bi bi-person-fill menu-icon"></i>Meu Perfil</a></li>
    </ul> 
{% endblock %}

{% block content %}
    <main class="main-carrinho">
        <section class="container-botoes-cima">
            <div class="notificacao-container">
                <a href="{% url 'notificacoes' %}">
                    <i class="bi bi-bell-fill icon-cima"></i>
                </a>
                {% if notificacoes_nao_lidas > 0 %}
                    <span class="notificacoes-nao-lidas">{{ notificacoes_nao_lidas }}</span>
                {% endif %}
            </div>
            <a href="/carrinho"><i class="bi bi-cart-fill icon-cima"></i></a>
            {% if user.is_authenticated %}
                <a class="ola-usuario" href="/perfil">Olá, <span>{{ user.username|first_name }}</span><i class="bi bi-chevron-down"></i></a>
            {% else %}
                <a><i class="bi bi-person-fill icon-cima"></i></a>
                <button class="button-sign"><a href="{% url 'login' %}">Entrar</a></button>
                <button class="button-sign"><a href="{% url 'cadastro' %}">Cadastrar</a></button>
            {% endif %}
        </section>
        <h1 class="position-relative" style="top: -12vh;">Meu Carrinho</h1>

        <div class="carrinho-container">
            {% if itens %}
                <table class="carrinho-tabela">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Quantidade</th>
                            <th>Preço Unitário</th>
                            <th>Subtotal</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in itens %}
                            <tr>
                                <td>
                                    <div class="produto-info-carrinho">
                                        <img src="/media/{{ item.produto.Imagem }}" alt="{{ item.produto.Nome }}" class="produto-imagem">
                                        <span>{{ item.produto.Nome }}</span>
                                    </div>
                                </td>
                                <td>
                                    <form method="POST" action="{% url 'atualizar_quantidade' item.id %}">
                                        {% csrf_token %}
                                        <input type="number" name="quantidade" value="{{ item.quantidade }}" min="1" class="input-quantidade">
                                        <button type="submit" class="button-atualizar"><i class="bi bi-arrow-repeat"></i></button>
                                    </form>
                                </td>
                                <td>R$ {{ item.produto.Preco|floatformat:2 }}</td>
                                <td>R$ {{ item.subtotal_value|floatformat:2 }}</td>

                                <td>
                                    <form method="POST" action="{% url 'remover_item' item.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="button-remover"><i class="bi bi-trash-fill"></i></button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="carrinho-total">
                    <h3>Total: R$ {{ total|floatformat:2 }}</h3>
                </div>
                <div class="carrinho-acoes">
                    <a href="{% url 'checkout' %}" class="button-finalizar">Finalizar Compra</a>
                    <a href="{% url 'home' %}" class="button-continuar">Continuar Comprando</a>
                </div>
            {% else %}
                <div class="carrinho-vazio">
                    <h3>Seu carrinho está vazio!</h3>
                    <a href="{% url 'home' %}" class="position-relative" class="button-voltar" style="top:-6vh">Voltar à loja</a>
                </div>
            {% endif %}
        </div>
    </main>
{% endblock %}

{% block script %}
    <script src="{% static 'js/carrinho.js' %}"></script>
{% endblock %}
